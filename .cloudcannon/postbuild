#!/bin/bash

# Change to repository root (where this script is located: .cloudcannon/)
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
REPO_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"
cd "$REPO_ROOT"

# Generate Pagefind search index
if [ -d "dist" ]; then
  echo "Generating Pagefind search index..."
  if npx --yes pagefind --site dist 2>&1; then
    echo "Pagefind search index generated successfully"
  else
    echo "Warning: pagefind failed, but continuing build..."
  fi
else
  echo "Warning: dist directory not found, skipping pagefind"
fi

echo "Postbuild complete"
exit 0