#!/bin/bash
set -e

# Scaffold optional directories for Agent Skills
# This script ensures all skills have the optional directories:
# - scripts/
# - references/
# - assets/

# Change to repository root (where this script is located: .cloudcannon/)
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
REPO_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"
cd "$REPO_ROOT"

SKILLS_DIR="$REPO_ROOT/src/content/skills"

if [ ! -d "$SKILLS_DIR" ]; then
  echo "Skills directory not found, skipping scaffolding"
  exit 0
fi

# Find all skill directories (directories containing SKILL.md)
find "$SKILLS_DIR" -type f -name "SKILL.md" | while read skill_file; do
  skill_dir=$(dirname "$skill_file")
  
  # Create optional directories if they don't exist
  for dir in "scripts" "references" "assets"; do
    optional_dir="${skill_dir}/${dir}"
    if [ ! -d "$optional_dir" ]; then
      mkdir -p "$optional_dir"
      # Create .gitkeep to ensure empty directories are tracked
      touch "${optional_dir}/.gitkeep"
      echo "Created ${optional_dir} for skill: $(basename "$skill_dir")"
    fi
  done
done

echo "Skill directory scaffolding complete"