---
export interface Props {
  contentBlocks: any[];
  propName?: string;
}

const components: Record<string, Function> = {};
const componentImports = import.meta.glob("../**/*.{jsx,astro}", {
  eager: true,
});

Object.entries(componentImports).forEach(([path, obj]) => {
  const parts = path.replace("../", "").split(".")[0].split("/");

  if (parts.length > 1 && parts[parts.length - 1] === parts[parts.length - 2]) {
    parts.pop();
  }
  const bookshopName = parts.join("/");

  components[bookshopName] = (obj as any).default;
});

const { contentBlocks, propName = "contentBlocks" } = Astro.props;
---

<editable-array data-editable="array" data-prop={propName} data-id-key="_bookshop_name">
  {
    contentBlocks?.map((block) => {
      const Component = components[block._bookshop_name];

      if (!Component && block._bookshop_name) {
        console.warn(
          `Component not found: ${block._bookshop_name}. Available components:`,
          Object.keys(components)
        );
      }

      return Component ? (
        <editable-array-item data-id={block._bookshop_name} data-component={block._bookshop_name}>
          <Component {...block} />
        </editable-array-item>
      ) : null;
    })
  }
</editable-array>
