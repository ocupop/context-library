---
import ComponentProperties from "@component-library/components/ComponentProperties/index.astro";
import ComponentViewer from "@component-library/components/ComponentViewer/index.astro";
import LibraryLayout from "@component-library/layouts/LibraryLayout.astro";

const { frontmatter, schema, bookshopData, examples = [], componentKey = "" } = Astro.props;
const meta = {
  description: bookshopData?.spec?.description || "No description available",
  title: bookshopData?.spec?.label || frontmatter.title,
};

const primaryExample = examples.find(
  (example: any) => example && example.id && example.id.includes("/primary")
);

const frontmatterExamples = frontmatter.examples || [];

const processedExamples = frontmatterExamples.map((exampleConfig: any) => {
  const matchingExamples = examples.filter((example: any) =>
    exampleConfig.slugs.some(
      (slug: string) => example && example.id && example.id.endsWith(`/${slug}`)
    )
  );

  const sortedExamples = matchingExamples.sort((a: any, b: any) => {
    const aSlug = a.id.split("/").pop();
    const bSlug = b.id.split("/").pop();
    const aIndex = exampleConfig.slugs.indexOf(aSlug);
    const bIndex = exampleConfig.slugs.indexOf(bSlug);

    return aIndex - bIndex;
  });

  return {
    title: exampleConfig.title,
    examples: sortedExamples,
    size: exampleConfig.size,
  };
});
const primarySize = frontmatter.primary_size || "md";
---

<LibraryLayout frontmatter={frontmatter}>
  <h1>{frontmatter.title}</h1>
  <p>{meta.description}</p>

  {
    primaryExample && (
      <ComponentViewer
        component_examples={[primaryExample]}
        title={meta.title}
        size={primarySize}
        componentKey={componentKey}
      />
    )
  }

  <h2>Properties</h2>
  <ComponentProperties bookshopData={bookshopData} />

  {processedExamples.length > 0 && <h2>Examples</h2>}

  {
    processedExamples.map((exampleGroup: any) => (
      <>
        <h3>{exampleGroup.title}</h3>
        {exampleGroup.examples.length > 0 && (
          <ComponentViewer
            component_examples={exampleGroup.examples}
            title={exampleGroup.title}
            size={exampleGroup.size}
            componentKey={componentKey}
          />
        )}
      </>
    ))
  }

  <slot />
</LibraryLayout>
